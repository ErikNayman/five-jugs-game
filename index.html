<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>5 –ö—É–≤—à–∏–Ω–æ–≤ ‚Äî –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">

<div class="min-h-screen flex flex-col items-center p-6 space-y-6">

  <div class="text-center">
    <h1 class="text-4xl font-bold mb-4">üè∫ 5 –ö—É–≤—à–∏–Ω–æ–≤ ‚Äî –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h1>
    <button onclick="runTurn()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 font-bold">–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ö–æ–¥</button>
  </div>

  <div id="summary" class="w-full max-w-3xl bg-white rounded shadow p-4">
    <p>–•–æ–¥: <span id="turn">0</span></p>
    <p>–°–æ–±—ã—Ç–∏–µ: <span id="event">-</span></p>
    <p>–¢–µ–∫—É—â–∏–π –±–∞–ª–ª: <span id="score">0</span></p>
  </div>

  <div class="w-full max-w-5xl bg-white rounded shadow p-4">
    <canvas id="scoreChart"></canvas>
  </div>

</div>

<script>
let turn = 0;
let savings = 0;
let investments = 0;
let health = 100;
let happiness = 90;
let scores = [];

const ctx = document.getElementById('scoreChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: '–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–∞–ª–ª—ã)',
      data: [],
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.3,
      fill: false
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    }
  }
});

function runTurn() {
  turn++;

  // —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
  let event = "–Ω–∏—á–µ–≥–æ";
  let expensePenalty = 0;
  let crisisLoss = 0;
  let healthPenalty = 0;

  const random = Math.random();
  if (random < 0.10) {
    event = "–º–µ–ª–∫–∞—è —Ç—Ä–∞—Ç–∞ ‚Äì$50";
    expensePenalty = -50;
  } else if (random < 0.20) {
    event = "–º–∏–Ω–∏-–∫—Ä–∏–∑–∏—Å: ‚Äì6% –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π";
    crisisLoss = investments * 0.06;
  } else if (random < 0.25) {
    event = "–±–æ–ª–µ–∑–Ω—å ‚Äì5% –∑–¥–æ—Ä–æ–≤—å—è";
    healthPenalty = health * 0.05;
  }

  // —ç–∫–æ–Ω–æ–º–∏–∫–∞ —Ö–æ–¥–∞
  const income = 1000;
  const survival = 500;
  const comfort = 500;
  const spending = survival + comfort;
  const freeMoney = income - spending + expensePenalty;

  savings += freeMoney;
  const growth = Math.random() <= 0.7 ? Math.random()*0.03 : Math.random()*-0.01;
  investments = (investments - crisisLoss) * (1 + growth);

  health -= healthPenalty;
  health = Math.max(0, Math.round(health));
  happiness = Math.max(0, Math.round(happiness));

  // —Ä–∞—Å—á–µ—Ç –±–∞–ª–ª–æ–≤
  let score = 0;
  score += Math.floor(savings / 1000);
  score += Math.floor(investments / 1000) * 2;
  if (health > 70) score += 20;
  if (happiness > 70) score += 20;
  const passiveIncome = (investments * 0.05 + savings * 0.03) / 12;
  if (passiveIncome > 1000) score += 30;

  scores.push(score);

  // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
  document.getElementById('turn').innerText = turn;
  document.getElementById('event').innerText = event;
  document.getElementById('score').innerText = score;

  // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
  chart.data.labels.push(turn);
  chart.data.datasets[0].data.push(score);
  chart.update();
}
</script>
</body>
</html>