<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>5 –ö—É–≤—à–∏–Ω–æ–≤ ‚Äî –ü–æ–ª–Ω—ã–π –ø–∞–∫–µ—Ç</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">

<div id="start-screen" class="min-h-screen flex flex-col items-center justify-center p-6">
  <h1 class="text-4xl font-bold mb-6 text-center">üè∫ 5 –ö—É–≤—à–∏–Ω–æ–≤</h1>
  <div class="bg-white p-6 rounded shadow w-full max-w-sm space-y-4 text-center">
    <h2 class="text-xl font-semibold mb-2">–í—ã–±–µ—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã:</h2>
    <button onclick="startGame(24)" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700">24 –º–µ—Å—è—Ü–∞</button>
    <button onclick="startGame(36)" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">36 –º–µ—Å—è—Ü–µ–≤</button>
  </div>
</div>

<div id="game-screen" class="hidden p-6 space-y-4 max-w-5xl mx-auto">
  <div class="grid grid-cols-2 gap-4">
    <input id="survival" type="number" placeholder="–¢—Ä–∞—Ç—ã –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ ($)" class="border p-2 rounded" value="500">
    <input id="comfort" type="number" placeholder="–¢—Ä–∞—Ç—ã –Ω–∞ –∫–æ–º—Ñ–æ—Ä—Ç ($)" class="border p-2 rounded" value="500">
    <input id="save" type="number" placeholder="–ù–∞ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è ($)" class="border p-2 rounded" value="0">
    <input id="invest" type="number" placeholder="–ù–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ ($)" class="border p-2 rounded" value="0">
    <input id="healthSpend" type="number" placeholder="–ù–∞ –∑–¥–æ—Ä–æ–≤—å–µ ($)" class="border p-2 rounded" value="0">
    <input id="edu" type="number" placeholder="–ù–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ($)" class="border p-2 rounded" value="0">
    <select id="extra" class="border p-2 rounded col-span-2">
      <option value="–Ω–µ—Ç">–†–∞–±–æ—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ? –ù–µ—Ç</option>
      <option value="–¥–∞">–†–∞–±–æ—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ? –î–∞</option>
    </select>
  </div>

  <button onclick="runTurn()" class="w-full mt-4 bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ö–æ–¥</button>

  <div class="text-center space-y-2 mt-4">
    <p>–•–æ–¥: <span id="turn">0</span> / <span id="maxTurns">0</span></p>
    <p>–°–æ–±—ã—Ç–∏–µ: <span id="event">-</span></p>
    <p>–°–≤–æ–±–æ–¥–Ω—ã–µ –¥–µ–Ω—å–≥–∏: <span id="free">$0</span></p>
    <p>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è: <span id="savings">$0</span></p>
    <p>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: <span id="investments">$0</span></p>

    <p>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="healthResult">100%</span></p>
    <div class="w-full h-3 bg-gray-300 rounded-full">
      <div id="healthBar" class="h-3 bg-green-500 rounded-full" style="width: 100%;"></div>
    </div>

    <p class="mt-2">–°—á–∞—Å—Ç—å–µ: <span id="happinessResult">90%</span></p>
    <div class="w-full h-3 bg-gray-300 rounded-full">
      <div id="happinessBar" class="h-3 bg-yellow-400 rounded-full" style="width: 90%;"></div>
    </div>
  </div>

  <div class="mt-8">
    <h2 class="text-xl font-bold text-center mb-2">üìò –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h2>
    <table class="w-full text-sm bg-white rounded shadow overflow-hidden">
      <thead class="bg-gray-200 font-bold">
        <tr>
          <th class="p-2">–•–æ–¥</th>
          <th class="p-2">–°–æ–±—ã—Ç–∏–µ</th>
          <th class="p-2">–°–≤–æ–±–æ–¥–Ω—ã–µ $</th>
          <th class="p-2">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</th>
          <th class="p-2">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</th>
          <th class="p-2">–ó–¥–æ—Ä–æ–≤—å–µ</th>
          <th class="p-2">–°—á–∞—Å—Ç—å–µ</th>
        </tr>
      </thead>
      <tbody id="historyTable" class="text-center"></tbody>
    </table>
  </div>

  <div class="mt-8">
    <h2 class="text-xl font-bold text-center mb-2">üìà –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <canvas id="scoreChart"></canvas>
  </div>

</div>

<div id="end-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-6 text-center">
  <h1 class="text-4xl font-bold mb-6">üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h1>
  <div class="bg-white p-6 rounded shadow w-full max-w-md space-y-4">
    <p id="endReason"></p>
    <p><strong>–ò—Ç–æ–≥–æ–≤—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è:</strong> <span id="finalSavings">$0</span></p>
    <p><strong>–ò—Ç–æ–≥–æ–≤—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</strong> <span id="finalInvestments">$0</span></p>
    <p><strong>–ó–¥–æ—Ä–æ–≤—å–µ:</strong> <span id="finalHealth">0%</span></p>
    <p><strong>–°—á–∞—Å—Ç—å–µ:</strong> <span id="finalHappiness">0%</span></p>
    <p><strong>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü:</strong> <span id="finalPassiveIncome">$0</span></p>
    <p><strong>–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> <span id="finalScore">0 –±–∞–ª–ª–æ–≤</span></p>
    <p><strong>–¢–≤–æ–π —Ç–∏—Ç—É–ª:</strong> <span id="finalTitle">-</span></p>
    <button onclick="location.reload()" class="mt-4 bg-green-600 text-white p-2 rounded hover:bg-green-700">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  </div>
</div>

<script>
// –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let turn = 0;
let maxTurns = 0;
let savings = 0;
let investments = 0;
let health = 100;
let happiness = 90;
let scores = [];

// –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
const ctx = document.getElementById('scoreChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: '–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–∞–ª–ª—ã)',
      data: [],
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.3,
      fill: false
    }]
  },
  options: {
    scales: {
      y: { beginAtZero: true }
    }
  }
});

function startGame(turns) {
  maxTurns = turns;
  document.getElementById('maxTurns').innerText = turns;
  document.getElementById('start-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  updateBars();
}

function runTurn() {
  turn++;

  // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
  let event = "–Ω–∏—á–µ–≥–æ";
  let expensePenalty = 0;
  let crisisLoss = 0;
  let healthPenalty = 0;

  const random = Math.random();
  if (random < 0.10) {
    event = "–º–µ–ª–∫–∞—è —Ç—Ä–∞—Ç–∞ ‚Äì$50";
    expensePenalty = -50;
  } else if (random < 0.20) {
    event = "–º–∏–Ω–∏-–∫—Ä–∏–∑–∏—Å: ‚Äì6% –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π";
    crisisLoss = investments * 0.06;
  } else if (random < 0.25) {
    event = "–±–æ–ª–µ–∑–Ω—å ‚Äì5% –∑–¥–æ—Ä–æ–≤—å—è";
    healthPenalty = health * 0.05;
  }

  const income = 1000;
  const survival = 500;
  const comfort = 500;
  const spending = survival + comfort;
  const freeMoney = income - spending + expensePenalty;

  savings += freeMoney;
  const growth = Math.random() <= 0.7 ? Math.random()*0.03 : Math.random()*-0.01;
  investments = (investments - crisisLoss) * (1 + growth);

  health -= healthPenalty;
  health = Math.max(0, Math.round(health));
  happiness = Math.max(0, Math.round(happiness));

  updateSummary(event, freeMoney);

  updateBars();
  updateHistory(event, freeMoney);
  updateChart();

  if (health <= 0 || happiness <= 0 || turn >= maxTurns) {
    finishGame("–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.");
  }
}

function updateSummary(event, freeMoney) {
  document.getElementById('turn').innerText = turn;
  document.getElementById('event').innerText = event;
  document.getElementById('free').innerText = `$${Math.round(freeMoney)}`;
  document.getElementById('savings').innerText = `$${Math.round(savings)}`;
  document.getElementById('investments').innerText = `$${Math.round(investments)}`;
  document.getElementById('healthResult').innerText = `${Math.round(health)}%`;
  document.getElementById('happinessResult').innerText = `${Math.round(happiness)}%`;
}

function updateBars() {
  document.getElementById('healthBar').style.width = `${health}%`;
  document.getElementById('happinessBar').style.width = `${happiness}%`;
}

function updateHistory(event, freeMoney) {
  const table = document.getElementById("historyTable");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="p-2">${turn}</td>
    <td class="p-2">${event}</td>
    <td class="p-2">$${Math.round(freeMoney)}</td>
    <td class="p-2">$${Math.round(savings)}</td>
    <td class="p-2">$${Math.round(investments)}</td>
    <td class="p-2">${health}%</td>
    <td class="p-2">${happiness}%</td>
  `;
  table.appendChild(row);
}

function updateChart() {
  let score = 0;
  score += Math.floor(savings / 1000);
  score += Math.floor(investments / 1000) * 2;
  if (health > 70) score += 20;
  if (happiness > 70) score += 20;
  const passiveIncome = (investments * 0.05 + savings * 0.03) / 12;
  if (passiveIncome > 1000) score += 30;

  scores.push(score);
  chart.data.labels.push(turn);
  chart.data.datasets[0].data.push(score);
  chart.update();
}

function finishGame(reason) {
  document.getElementById('game-screen').classList.add('hidden');
  document.getElementById('end-screen').classList.remove('hidden');
  document.getElementById('endReason').innerText = reason;

  const passiveIncome = (investments * 0.05 + savings * 0.03) / 12;
  let finalScore = scores[scores.length - 1];
  let title = "–ù–æ–≤–∏—á–æ–∫";
  if (finalScore >= 80) title = "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–∞–≥–Ω–∞—Ç";
  else if (health > 90) title = "–ó–¥–æ—Ä–æ–≤—è–∫";
  else if (happiness > 90) title = "–°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫";
  else if (health < 30) title = "–í—ã–∂–∏–≤—à–∏–π";

  document.getElementById('finalSavings').innerText = `$${Math.round(savings)}`;
  document.getElementById('finalInvestments').innerText = `$${Math.round(investments)}`;
  document.getElementById('finalHealth').innerText = `${Math.round(health)}%`;
  document.getElementById('finalHappiness').innerText = `${Math.round(happiness)}%`;
  document.getElementById('finalPassiveIncome').innerText = `$${Math.round(passiveIncome)}`;
  document.getElementById('finalScore').innerText = `${finalScore} –±–∞–ª–ª–æ–≤`;
  document.getElementById('finalTitle').innerText = title;
}
</script>
</body>
</html>