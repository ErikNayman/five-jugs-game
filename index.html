<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>5 –ö—É–≤—à–∏–Ω–æ–≤ ‚Äî –ü–æ–ª–Ω–∞—è –∏–≥—Ä–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
<div class="min-h-screen flex flex-col items-center p-6 space-y-6">
  <h1 class="text-4xl font-bold text-center">üè∫ 5 –ö—É–≤—à–∏–Ω–æ–≤</h1>

  <div class="bg-white p-4 rounded shadow w-full max-w-xl space-y-4 text-center">
    <h2 class="text-lg font-semibold">–í—ã–±–µ—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã:</h2>
    <button onclick="startGame(24)" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">24 –º–µ—Å—è—Ü–∞</button>
    <button onclick="startGame(36)" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">36 –º–µ—Å—è—Ü–µ–≤</button>
  </div>

  <div id="game" class="hidden w-full max-w-5xl space-y-6">
    <div class="grid grid-cols-2 gap-4">
      <input id="survival" type="number" placeholder="–¢—Ä–∞—Ç—ã –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ" class="border p-2 rounded" value="500">
      <input id="comfort" type="number" placeholder="–¢—Ä–∞—Ç—ã –Ω–∞ –∫–æ–º—Ñ–æ—Ä—Ç" class="border p-2 rounded" value="500">
      <input id="save" type="number" placeholder="–ù–∞ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è" class="border p-2 rounded" value="0">
      <input id="invest" type="number" placeholder="–ù–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" class="border p-2 rounded" value="0">
      <input id="healthSpend" type="number" placeholder="–ù–∞ –∑–¥–æ—Ä–æ–≤—å–µ" class="border p-2 rounded" value="0">
      <input id="edu" type="number" placeholder="–ù–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" class="border p-2 rounded" value="0">
      <select id="extra" class="border p-2 rounded col-span-2">
        <option value="–Ω–µ—Ç">–†–∞–±–æ—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ? –ù–µ—Ç</option>
        <option value="–¥–∞">–†–∞–±–æ—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ? –î–∞</option>
      </select>
    </div>

    <button onclick="runTurn()" class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ö–æ–¥</button>

    <div class="text-center space-y-2">
      <p>–•–æ–¥: <span id="turn">0</span> / <span id="maxTurns">0</span></p>
      <p>–°–æ–±—ã—Ç–∏–µ: <span id="event">-</span></p>
      <p>–°–≤–æ–±–æ–¥–Ω—ã–µ –¥–µ–Ω—å–≥–∏: <span id="free">$0</span></p>
      <p>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è: <span id="savings">$0</span></p>
      <p>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: <span id="investments">$0</span></p>
      <p>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="healthResult">100%</span></p>
      <div class="w-full h-2 bg-gray-300 rounded-full"><div id="healthBar" class="h-2 bg-green-500 rounded-full" style="width: 100%"></div></div>
      <p>–°—á–∞—Å—Ç—å–µ: <span id="happinessResult">90%</span></p>
      <div class="w-full h-2 bg-gray-300 rounded-full"><div id="happinessBar" class="h-2 bg-yellow-400 rounded-full" style="width: 90%"></div></div>
    </div>

    <div>
      <h2 class="text-lg font-bold mb-2">–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h2>
      <table class="w-full text-sm bg-white rounded shadow overflow-hidden">
        <thead class="bg-gray-200 font-bold">
          <tr>
            <th class="p-2">–•–æ–¥</th>
            <th class="p-2">–°–æ–±—ã—Ç–∏–µ</th>
            <th class="p-2">–°–≤–æ–±–æ–¥–Ω—ã–µ $</th>
            <th class="p-2">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</th>
            <th class="p-2">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</th>
            <th class="p-2">–ó–¥–æ—Ä–æ–≤—å–µ</th>
            <th class="p-2">–°—á–∞—Å—Ç—å–µ</th>
          </tr>
        </thead>
        <tbody id="historyTable" class="text-center"></tbody>
      </table>
    </div>

    <div>
      <h2 class="text-lg font-bold mb-2">–ì—Ä–∞—Ñ–∏–∫ –±–∞–ª–ª–æ–≤</h2>
      <canvas id="scoreChart"></canvas>
    </div>
  </div>
</div>

<script>
let turn = 0, maxTurns = 0, savings = 0, investments = 0, health = 100, happiness = 90, scores = [];

const chart = new Chart(document.getElementById('scoreChart'), {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: '–ë–∞–ª–ª—ã',
      data: [],
      borderColor: 'rgb(75,192,192)',
      tension: 0.3,
      fill: false
    }]
  },
  options: {
    responsive: true,
    scales: { y: { beginAtZero: true } }
  }
});

function startGame(turns) {
  maxTurns = turns;
  document.getElementById("maxTurns").innerText = turns;
  document.getElementById("start-screen").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  updateBars();
}

function runTurn() {
  turn++;
  let survival = +document.getElementById('survival').value;
  let comfort = +document.getElementById('comfort').value;
  let save = +document.getElementById('save').value;
  let invest = +document.getElementById('invest').value;
  let healthSpend = +document.getElementById('healthSpend').value;
  let edu = +document.getElementById('edu').value;
  let extra = document.getElementById('extra').value;

  let income = 1000;
  if (extra === "–¥–∞") income += 200;

  let event = "–Ω–∏—á–µ–≥–æ";
  let random = Math.random(), penalty = 0, crisis = 0, sick = 0;
  if (random < 0.10) { event = "–º–µ–ª–∫–∞—è —Ç—Ä–∞—Ç–∞ -$50"; penalty = -50; }
  else if (random < 0.20) { event = "–∫—Ä–∏–∑–∏—Å -6% –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π"; crisis = investments * 0.06; }
  else if (random < 0.25) { event = "–±–æ–ª–µ–∑–Ω—å -5% –∑–¥–æ—Ä–æ–≤—å—è"; sick = health * 0.05; }

  let free = income - (survival + comfort + save + invest + healthSpend + edu) + penalty;
  savings += save + free;
  let growth = Math.random() <= 0.7 ? Math.random()*0.03 : Math.random()*-0.01;
  investments = (investments + invest - crisis) * (1 + growth);

  health -= sick;
  if (extra === "–¥–∞") health -= health * 0.05;
  if (survival < 500) health -= ((500 - survival)/500)*100;
  if (survival >= 500) health += 5;
  if (happiness >= 90) health += 5;
  health += (healthSpend / 500) * 50;
  health = Math.max(0, Math.min(100, Math.round(health)));

  if (comfort < 500) happiness -= ((500 - comfort)/500)*10;
  if (extra === "–¥–∞") happiness -= 5;
  happiness = Math.max(0, Math.round(happiness));

  document.getElementById("turn").innerText = turn;
  document.getElementById("event").innerText = event;
  document.getElementById("free").innerText = `$${Math.round(free)}`;
  document.getElementById("savings").innerText = `$${Math.round(savings)}`;
  document.getElementById("investments").innerText = `$${Math.round(investments)}`;
  document.getElementById("healthResult").innerText = `${health}%`;
  document.getElementById("happinessResult").innerText = `${happiness}%`;

  updateBars();
  updateChart();
  updateHistory(event, free);
}

function updateBars() {
  document.getElementById('healthBar').style.width = `${health}%`;
  document.getElementById('happinessBar').style.width = `${happiness}%`;
}

function updateChart() {
  let score = Math.floor(savings / 1000) + Math.floor(investments / 1000) * 2;
  if (health > 70) score += 20;
  if (happiness > 70) score += 20;
  let passive = (investments * 0.05 + savings * 0.03) / 12;
  if (passive > 1000) score += 30;

  scores.push(score);
  chart.data.labels.push(turn);
  chart.data.datasets[0].data.push(score);
  chart.update();
}

function updateHistory(event, free) {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="p-2">${turn}</td>
    <td class="p-2">${event}</td>
    <td class="p-2">$${Math.round(free)}</td>
    <td class="p-2">$${Math.round(savings)}</td>
    <td class="p-2">$${Math.round(investments)}</td>
    <td class="p-2">${health}%</td>
    <td class="p-2">${happiness}%</td>
  `;
  document.getElementById("historyTable").appendChild(row);
}
</script>
</body>
</html>